from django.shortcuts import render
from .forms import UserInputForm
from .models import UserInput
from django.http import HttpResponseRedirect
import sys
import os




nutrition_fax = {'https://www.epicurious.com/recipes/food/views/roast-sausage-and-fennel-with-orange': [246.11000000000004, 105.35000000000001, 132.335, 6866.0], 'https://www.epicurious.com/recipes/food/views/antipasto-pasta-with-sausage-artichoke-hearts-and-sun-dried-tomatoes': [76.4725, 75.3375, 78.00124999999998, 3446.25], 'https://www.epicurious.com/recipes/food/views/turkey-posole-51255500': [356.03999999999996, 323.89, 207.269, 7515.0], 'https://www.epicurious.com/recipes/food/views/cheesy-kale-and-mushroom-strata': [421.115, 516.385, 223.84400000000002, 10053.5], 'https://www.epicurious.com/recipes/food/views/pasta-with-sausage-and-arugula': [244.56, 198.89, 96.587, 7664.0], 'https://www.epicurious.com/recipes/food/views/citrus-shrimp-rice-bowls': [244.56000000000003, 155.48000000000002, 0, 2275.0], 'https://www.epicurious.com/recipes/food/views/chicken-soup-with-charred-cabbage': [557.52, 162.12, 88.621, 5348.0], 'https://www.epicurious.com/recipes/food/views/coconut-apple-ginger-dal': [347.8325, 115.9325, 29.146, 3831.75], 'https://www.epicurious.com/recipes/food/views/charred-steak-and-broccolini-with-cheese-sauce': [304.8825, 186.48499999999999, 138.94625000000002, 4926.75], 'https://www.epicurious.com/recipes/food/views/one-dish-baked-chicken-with-tomatoes-and-olives': [967.7500000000001, 210.32000000000002, 91.37266666666666, 9527.666666666666], 'https://www.epicurious.com/recipes/food/views/ancho-chile-pork-tenderloin-with-brussels-sprouts-and-squash': [269.6625, 135.63, 0, 6115.0], 'https://www.epicurious.com/recipes/food/views/chicken-pot-tot-hotdish': [876.3475, 205.9775, 0, 6150.25], 'https://www.epicurious.com/recipes/food/views/pasta-with-delicata-squash-and-sage-brown-butter': [44.26, 8.465, 28.563000000000002, 861.0], 'https://www.epicurious.com/recipes/food/views/herbed-chickpeas': [578.08, 112.64, 6.610666666666666, 3038.6666666666665], 'https://www.epicurious.com/recipes/food/views/smoky-beans-and-greens-on-toast': [1007.05, 247.50000000000003, 58.995999999999995, 7620.0], 'https://www.epicurious.com/recipes/food/views/slow-roasted-salmon-with-cherry-tomatoes-and-couscous-395923': [669.9399999999998, 146.13, 167.906, 13515.0], 'https://www.epicurious.com/recipes/food/views/simple-one-skillet-chicken-alfredo-pasta': [299.01000000000005, 78.3675, 69.50849999999998, 3571.0], 'https://www.epicurious.com/recipes/food/views/salmon-salad-with-beans-15631': [225.18, 32.705, 46.87741666666666, 3548.6666666666665], 'https://www.epicurious.com/recipes/food/views/istanbul-style-wet-burger-islak-burger': [593.4575000000001, 136.74, 168.674, 7710.5], 'https://www.epicurious.com/recipes/food/views/turkey-for-twenty': [832.9474999999999, 231.22500000000005, 0, 5579.0], 'https://www.epicurious.com/recipes/food/views/roasted-cauliflower-with-parmesan-panko-crumble': [659.82, 329.455, 158.73999999999998, 7648.0], 'https://www.epicurious.com/recipes/food/views/crispy-chicken-and-potatoes-with-cabbage-slaw': [150.885, 208.31000000000003, 84.35674999999999, 3280.25], 'https://www.epicurious.com/recipes/food/views/nextover-chicken-tacos-with-quick-refried-beans': [317.29, 178.74999999999997, 0, 5230.0], 'https://www.epicurious.com/recipes/food/views/shrimp-poached-in-coconut-milk-with-fresh-herbs-yerra-moolee': [613.4549999999999, 280.0, 631.6215000000003, 11133.0], 'https://www.epicurious.com/recipes/food/views/silky-pork-and-cumin-stew': [626.72, 129.285, 91.93249999999998, 8474.0], 'https://www.epicurious.com/recipes/food/views/slow-cooked-chicken-stew-with-kale': [762.29, 525.075, 196.68666666666667, 10008.166666666668], 'https://www.epicurious.com/recipes/food/views/slow-cooked-halibut-with-garlic-cream-and-fennel': [139.7, 215.01999999999998, 98.48700000000001, 3472.0], 'https://www.epicurious.com/recipes/food/views/curried-chickpea-and-lentil-dal': [636.555, 295.29499999999996, 80.04799999999999, 8541.0], 'https://www.epicurious.com/recipes/food/views/warm-spiced-saucy-lamb-stew': [424.58500000000004, 221.125, 107.2665, 7536.5], 'https://www.epicurious.com/recipes/food/views/ham-hock-and-white-bean-stew': [545.3449999999999, 177.645, 169.36, 9520.5], 'https://www.epicurious.com/recipes/food/views/oxtail-and-red-wine-stew': [333.3075, 267.2150000000001, 120.86100000000002, 8497.0], 'https://www.epicurious.com/recipes/food/views/roast-fish-with-cannellini-beans-and-green-olives': [334.50000000000006, 120.99000000000001, 83.84199999999998, 6331.5], 'https://www.epicurious.com/recipes/food/views/herby-pasta-with-garlic-and-green-olives': [178.72750000000002, 146.4525, 56.53425, 3206.5], 'https://www.epicurious.com/recipes/food/views/roast-chicken-legs-with-lots-of-garlic': [245.07, 112.0, 72.93900000000001, 3209.0], 'https://www.epicurious.com/recipes/food/views/baked-pasta-alla-norma': [477.62999999999994, 201.89, 85.40975, 4376.5], 'https://www.epicurious.com/recipes/food/views/butternut-squash-steaks-with-brown-buttersage-sauce': [529.97, 98.85, 84.94300000000001, 4957.0], 'https://www.epicurious.com/recipes/food/views/oven-polenta-with-roasted-mushrooms-and-thyme': [608.7599999999999, 262.30000000000007, 108.60900000000001, 6099.0], 'https://www.epicurious.com/recipes/food/views/poached-eggs-in-tomato-sauce-with-chickpeas-and-feta-368963': [742.5600000000001, 230.63, 49.177, 4616.0], 'https://www.epicurious.com/recipes/food/views/vegetarian-three-bean-chili': [433.0525, 93.79249999999999, 37.85200000000001, 4659.25], 'https://www.epicurious.com/recipes/food/views/pressed-broccoli-rabe-and-mozzarella-sandwiches': [525.56, 69.14500000000001, 59.41299999999999, 5614.5], 'https://www.epicurious.com/recipes/food/views/manchurian-green-beans-with-tofu': [541.96, 147.44, 14.079, 3499.75], 'https://www.epicurious.com/recipes/food/views/lentil-soup-with-wheat-berries-and-kale': [887.8350000000002, 239.59000000000003, 17.812, 4840.25], 'https://www.epicurious.com/recipes/food/views/sweet-potato-toasts-with-toppings': [8.82, 2.49, 0.111, 42.0], 'https://www.epicurious.com/recipes/food/views/beet-and-carrot-salad': [218.765, 132.2525, 59.044, 3435.0], 'https://www.epicurious.com/recipes/food/views/picnic-three-bean-salad': [191.59250000000003, 32.0075, 46.035, 2920.5], 'https://www.epicurious.com/recipes/food/views/air-fryer-caramelized-eggplant-with-harissa-yogurt': [408.43, 59.52, 173.483, 4303.5], 'https://www.epicurious.com/recipes/food/views/lentil-and-chicken-soup-with-sweet-potatoes-and-escarole': [162.10000000000002, 182.625, 43.60149999999999, 3704.25], 'https://www.epicurious.com/recipes/food/views/roasted-apricot-chicken-with-mint-and-sage-butternut-squash': [869.06, 236.35750000000002, 0, 7420.5], 'https://www.epicurious.com/recipes/food/views/chicken-and-squash-cacciatore-mushrooms-tomatoes-olives-bread': [1014.5350000000001, 311.0, 89.20450000000001, 6999.5], 'https://www.epicurious.com/recipes/food/views/chicken-nuggets-with-mango-and-avocado-salsa-56389602': [315.97, 139.52, 116.07133333333333, 5139.5], 'https://www.epicurious.com/recipes/food/views/creamy-one-pot-pasta-with-sausage-and-squash': [343.3675, 214.77, 133.05149999999998, 6784.75], 'https://www.epicurious.com/recipes/food/views/root-vegetable-hash': [532.67, 56.75999999999999, 28.6, 4168.0], 'https://www.epicurious.com/recipes/food/views/new-years-eve-meat-pie': [355.03000000000003, 143.74, 33.236, 3020.0], 'https://www.epicurious.com/recipes/food/views/pineapple-glazed-ham': [245.49, 56.6725, 0, 1288.75], 'https://www.epicurious.com/recipes/food/views/vegetarian-skillet-stuffed-shells': [1007.7300000000001, 380.055, 135.75699999999998, 9943.0], 'https://www.epicurious.com/recipes/food/views/classic-herb-and-fennel-stuffing': [773.9599999999999, 211.98499999999999, 62.994, 5709.5], 'https://www.epicurious.com/recipes/food/views/nutella-grilled-cheese': [292.33500000000004, 56.294999999999995, 34.995000000000005, 3148.5], 'https://www.epicurious.com/recipes/food/views/baked-feta-and-greens-with-lemony-yogurt': [532.37, 171.92, 91.33449999999999, 8175.5], 'https://www.epicurious.com/recipes/food/views/irish-brown-bread-109216': [610.43, 131.5, 41.730999999999995, 4204.5], 'https://www.epicurious.com/recipes/food/views/cioppino-seafood-stew-with-gremolata-toasts-51248830': [898.0875000000001, 279.76500000000004, 89.68325, 7806.75], 'https://www.epicurious.com/recipes/food/views/toasted-baguette-with-tomatoes-and-anchovies-107134': [395.56, 65.21000000000001, 9.259666666666666, 2093.6666666666665], 'https://www.epicurious.com/recipes/food/views/irish-brown-bread-with-smoked-salmon-104997': [324.2391666666666, 70.25416666666668, 15.720833333333333, 2391.0], 'https://www.epicurious.com/recipes/food/views/weeknight-tandoori-chicken': [848.3050000000001, 226.305, 40.291, 5999.0], 'https://www.epicurious.com/recipes/food/views/indian-spiced-pork-roast-with-rosemary-and-onions': [829.53, 173.21, 39.2245, 5130.5], 'https://www.epicurious.com/recipes/food/views/indian-style-butter-chicken-curry': [1759.0125000000003, 317.53, 0, 16870.0], 'https://www.epicurious.com/recipes/food/views/arugula-and-persimmon-salad-with-pistachio-vinaigrette': [91.64750000000001, 55.645, 31.889249999999997, 2546.0], 'https://www.epicurious.com/recipes/food/views/almond-butter-and-banana-pancakes': [418.79999999999995, 61.47, 72.16199999999999, 3588.0], 'https://www.epicurious.com/recipes/food/views/citrus-and-dill-gravlax': [258.65999999999997, 31.080000000000002, 0, 1172.0], 'https://www.epicurious.com/recipes/food/views/vegetable-frittata-with-asiago-cheese-4242': [441.5775, 608.4674999999999, 53.7145, 6202.75]}

# Create your views here.
def getinputdata(request):
    if request.method=="POST":
        form = UserInputForm(request.POST)
        if form.is_valid():
            UserInput.objects.all().delete()
            user_input = form.save(commit=False)
            user_input.save()
            prots = user_input.proteins
            carbohydrates = user_input.carbohydrates
            fat = user_input.fat
            calories = user_input.calories
            user_input_data = [carbohydrates, prots, fat, calories]
            error = {}
            for url in nutrition_fax:
                e = ((nutrition_fax[url][0]-user_input_data[0])**2 + (nutrition_fax[url][1]-user_input_data[1])**2 + (nutrition_fax[url][2]-user_input_data[2])**2 + (nutrition_fax[url][3] - user_input_data[3])**2)**0.5
                error[url] = e
            min_error = 99999999
            res_url = ""
            for url in error:
                if error[url] < min_error:
                    min_error = error[url]
                    res_url = url
            return HttpResponseRedirect(res_url)

    else:
        form = UserInputForm()
    return render(request, 'get_data/get_data_form.html', {'form':form})
